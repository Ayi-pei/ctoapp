# ğŸ”§ æ•´åˆåçš„æ•°æ®åº“è®¾ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æˆ‘å·²ç»å°†è‡ªå®šä¹‰è®¤è¯çš„æ‰€æœ‰SQLä»£ç æ•´åˆåˆ°æ ¹ç›®å½•çš„ `supabase.sql` æ–‡ä»¶ä¸­ï¼Œç°åœ¨æ”¯æŒ**åŒé‡è®¤è¯æ¨¡å¼**ï¼š

1. **Supabase Auth** (åŸç‰ˆé‚®ç®±è®¤è¯)
2. **Custom Auth** (è‡ªå®šä¹‰ç”¨æˆ·åå¯†ç è®¤è¯)

## ğŸš€ ä¸€é”®éƒ¨ç½²

åªéœ€åœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­è¿è¡Œæ ¹ç›®å½•çš„ `supabase.sql` æ–‡ä»¶å³å¯å®Œæˆæ‰€æœ‰è®¾ç½®ã€‚

## ğŸ¯ æ•´åˆçš„åŠŸèƒ½

### âœ… æ•°æ®åº“è¡¨æ›´æ–°
- `profiles` è¡¨æ–°å¢ `password_plain` å­—æ®µ
- ä¿æŒä¸åŸæœ‰ Supabase Auth çš„å…¼å®¹æ€§
- æ·»åŠ äº†è‡ªå®šä¹‰è®¤è¯æ‰€éœ€çš„ç´¢å¼•

### âœ… åŒé‡è§¦å‘å™¨ç³»ç»Ÿ
```sql
-- Supabase Auth è§¦å‘å™¨ (åŸæœ‰)
on_auth_user_created -> handle_new_user()

-- è‡ªå®šä¹‰è®¤è¯è§¦å‘å™¨ (æ–°å¢)
on_custom_user_created -> handle_new_user_custom()
```

### âœ… è‡ªåŠ¨ç®¡ç†å‘˜åˆ›å»º
- ç”¨æˆ·å: `adminsrf`
- å¯†ç : `admin8888`
- é‚€è¯·ç : `159753`
- è‡ªåŠ¨åˆ†é… 1,000,000 å„ç§èµ„äº§ä½™é¢

### âœ… ç™»å½•éªŒè¯å‡½æ•°
```sql
-- æ–°å¢çš„ç™»å½•éªŒè¯å‡½æ•°
public.verify_login(username, password)
```

### âœ… å…¼å®¹çš„å®‰å…¨ç­–ç•¥
- ä¿æŒåŸæœ‰çš„ RLS ç­–ç•¥
- æ·»åŠ è‡ªå®šä¹‰è®¤è¯å…¼å®¹ç­–ç•¥

## ğŸ”„ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šSupabase Auth (åŸç‰ˆ)
- è®¿é—® `/login` å’Œ `/register`
- ä½¿ç”¨é‚®ç®±æ ¼å¼è®¤è¯
- ä¾èµ– Supabase Auth ç³»ç»Ÿ

### æ–¹å¼äºŒï¼šCustom Auth (æ–°ç‰ˆ)
- è®¿é—® `/login-custom` å’Œ `/register-custom`
- çº¯ç”¨æˆ·åå¯†ç è®¤è¯
- ä¸ä¾èµ–é‚®ç®±

## ğŸ“± åº”ç”¨å±‚é…ç½®

### 1. æ›´æ–° layout.tsx
```tsx
// é€‰æ‹©ä½¿ç”¨å“ªç§è®¤è¯ç³»ç»Ÿ

// é€‰é¡¹A: ä½¿ç”¨åŸç‰ˆ Supabase Auth
import { AuthProvider } from "@/context/auth-context";
<AuthProvider>{children}</AuthProvider>

// é€‰é¡¹B: ä½¿ç”¨è‡ªå®šä¹‰è®¤è¯
import { SimpleAuthProvider } from "@/context/simple-custom-auth";
<SimpleAuthProvider>{children}</SimpleAuthProvider>
```

### 2. æ›´æ–°ç»„ä»¶ä¸­çš„ Hook
```tsx
// å¯¹åº”é€‰æ‹©çš„è®¤è¯ç³»ç»Ÿ

// é€‰é¡¹A: åŸç‰ˆ
import { useAuth } from '@/context/auth-context';

// é€‰é¡¹B: è‡ªå®šä¹‰
import { useSimpleAuth } from '@/context/simple-custom-auth';
```

## ğŸ›ï¸ ç¯å¢ƒå˜é‡
ç¡®ä¿ `.env.local` åŒ…å«ï¼š
```env
NEXT_PUBLIC_ADMIN_NAME=adminsrf
NEXT_PUBLIC_ADMIN_KEY=admin8888
NEXT_PUBLIC_ADMIN_AUTH=159753
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### æ•°æ®å®Œæ•´æ€§
- ä¸¤ç§è®¤è¯ç³»ç»Ÿå…±äº«ç›¸åŒçš„ç”¨æˆ·æ•°æ®
- ç»Ÿä¸€çš„æƒé™æ§åˆ¶å’Œä½™é¢ç®¡ç†
- å…¼å®¹çš„ RLS ç­–ç•¥

### ç®¡ç†å‘˜æƒé™
- ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ä»»ä¸€ç³»ç»Ÿç™»å½•
- ç»Ÿä¸€çš„ç®¡ç†å‘˜æƒé™éªŒè¯
- è‡ªåŠ¨åˆå§‹åŒ–ç®¡ç†å‘˜èµ„äº§

## ğŸ§ª æµ‹è¯•æµç¨‹

### 1. æ•°æ®åº“éƒ¨ç½²
```sql
-- åœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­è¿è¡Œ
-- æ ¹ç›®å½•çš„ supabase.sql æ–‡ä»¶
```

### 2. ç®¡ç†å‘˜ç™»å½•æµ‹è¯•
```
æ–¹å¼A: /login
ç”¨æˆ·å: adminsrf
å¯†ç : admin8888

æ–¹å¼B: /login-custom  
ç”¨æˆ·å: adminsrf
å¯†ç : admin8888
```

### 3. æ™®é€šç”¨æˆ·æ³¨å†Œæµ‹è¯•
```
æ–¹å¼A: /register
ç”¨æˆ·å: testuser
å¯†ç : password123
é‚€è¯·ç : 159753

æ–¹å¼B: /register-custom
ç”¨æˆ·å: testuser2
å¯†ç : password123
é‚€è¯·ç : 159753
```

## ğŸ‰ ä¼˜åŠ¿

- âœ… **å‘åå…¼å®¹**: åŸæœ‰åŠŸèƒ½å®Œå…¨ä¿ç•™
- âœ… **çµæ´»é€‰æ‹©**: å¯ä»¥é€‰æ‹©ä»»ä¸€è®¤è¯æ–¹å¼
- âœ… **ç»Ÿä¸€æ•°æ®**: ä¸¤ç§æ–¹å¼å…±äº«ç”¨æˆ·æ•°æ®
- âœ… **ç®€åŒ–éƒ¨ç½²**: ä¸€ä¸ªSQLæ–‡ä»¶å®Œæˆæ‰€æœ‰è®¾ç½®
- âœ… **æ— ç¼åˆ‡æ¢**: å¯ä»¥éšæ—¶åœ¨ä¸¤ç§æ–¹å¼é—´åˆ‡æ¢

ç°åœ¨æ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä½¿ç”¨å“ªç§è®¤è¯æ–¹å¼ï¼Œæˆ–è€…åŒæ—¶æ”¯æŒä¸¤ç§æ–¹å¼ï¼